var socketio = require('socket.io');

exports.listen = function(server) {
var mongo = require('mongodb');

var db = new mongo.Db('Users', new mongo.Server('localhost', 27017), {safe: true});

db.open(function (err,db) {
  if(!err) {
    console.log("We are connected");
  }
	else {
	console.log("We aren't connected" + err);
}
});



	var io = socketio.listen(server);
	io.set('log level', 1);
	io.sockets.on('connection', function (socket) {
		console.log('connection');
		socket.on('connect', function(data){			
			connect(socket, data);
			console.log("serwer connect");
		});
		
		socket.on('user', function (data){
			createuser(socket,data);
		});
	});


function connect(socket,data){


//io.sockets.emit('ready', { client: Members[socket.id] });

}

function createuser(socket,data){

var zm1=data.username,zm2=data.password,zm3=data.email;
	
	db.collection('users', function (err,collection) {
 		collection.insert({"username": zm1, "password": zm2, "email": zm3});
	});
io.sockets.emit('ready', { username: zm1});		
}


function randomID(){
		return (((1 + Math.random()) * 0x10000) | 0);
	}

}
